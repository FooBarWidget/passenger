#!/usr/bin/env ruby
require 'pathname'
$LOAD_PATH.unshift(File.expand_path("#{File.dirname(__FILE__)}/../lib"))
require 'passenger/spawn_manager'
require 'passenger/utils'

begin
	STDOUT.sync = true
	STDERR.sync = true
	$0 = "Passenger spawn server"
	if GC.respond_to?(:copy_on_write_friendly=)
		GC.copy_on_write_friendly = true
	end
	spawn_manager = Passenger::SpawnManager.new
	input = IO.new(Passenger::SpawnManager::DEFAULT_INPUT_FD)
	spawn_manager.start_synchronously(input)
	spawn_manager.cleanup
rescue => e
	include Passenger::Utils
	print_exception("spawn manager", e)
	exit 10
end
