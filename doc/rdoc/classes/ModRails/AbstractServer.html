<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Class: ModRails::AbstractServer</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />

    <script language="JavaScript" type="text/javascript">
    // <![CDATA[

        function toggleSource( id )
        {
          var elem
          var link

          if( document.getElementById )
          {
            elem = document.getElementById( id )
            link = document.getElementById( "l_" + id )
          }
          else if ( document.all )
          {
            elem = eval( "document.all." + id )
            link = eval( "document.all.l_" + id )
          }
          else
            return false;

          if( elem.style.display == "block" )
          {
            elem.style.display = "none"
            link.innerHTML = "show source"
          }
          else
          {
            elem.style.display = "block"
            link.innerHTML = "hide source"
          }
        }

        function openCode( url )
        {
          window.open( url, "SOURCE_CODE", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=480,width=750" ).focus();
        }
      // ]]>
    </script>
  </head>

  <body>
  <table width="100%" border='0' cellpadding='0' cellspacing='0' class='banner'><tr>
  <td class="file-title"><span class="file-title-prefix">Class</span><br />ModRails::AbstractServer</td>
  <td align="right">
    <table cellspacing="0" cellpadding="2">
      <tr valign="top">
        <td>In:</td>
        <td>
<a href="../../files/lib/mod_rails/abstract_server_rb.html">lib/mod_rails/abstract_server.rb</a>
        </td>
      </tr>
    <tr>
      <td>Parent:</td>
      <td>
Object
     </td>
   </tr>
         </table>
        </td>
        </tr>
      </table>
 <!-- banner header -->

  <div id="bodyContent">
      <div id="content">

  <div class="description"><p>
An abstract base class for a server, with the following properties:
</p>
<ul>
<li>The server has exactly one client, and is connected to that client at all
times. The server will quit when the connection closes.

</li>
<li>The server&#8216;s main loop may be run in a child process (and so is
asynchronous from the main process).

</li>
<li>One can communicate with the server through discrete messages (as opposed
to byte streams).

</li>
<li>The server can pass file descriptors (IO objects) back to the client.

</li>
</ul>
<p>
A message is just an ordered list of strings. The first element in the
message is the _message name_.
</p>
<p>
The server will also reset all signal handlers (in the child process). That
is, it will respond to all signals in the default manner. The only
exception is SIGHUP, which is ignored. One may define additional signal
handlers using <a
href="AbstractServer.html#M000046">define_signal_handler</a>().
</p>
<p>
Before an <a href="AbstractServer.html">AbstractServer</a> can be used, it
must first be started by calling <a
href="AbstractServer.html#M000038">start</a>(). When it is no longer
needed, <a href="AbstractServer.html#M000040">stop</a>() should be called.
</p>
<p>
Here&#8216;s an example on using <a
href="AbstractServer.html">AbstractServer</a>:
</p>
<pre>
 class MyServer &lt; ModRails::AbstractServer
    def initialize
       super()
       define_message_handler(:hello, :handle_hello)
    end

    def hello(first_name, last_name)
       send_to_server('hello', first_name, last_name)
       reply, pointless_number = recv_from_server
       puts &quot;The server said: #{reply}&quot;
       puts &quot;In addition, it sent this pointless number: #{pointless_number}&quot;
    end

 private
    def handle_hello(first_name, last_name)
       send_to_client(&quot;Hello #{first_name} #{last_name}, how are you?&quot;, 1234)
    end
 end

 server = MyServer.new
 server.start
 server.hello(&quot;Joe&quot;, &quot;Dalton&quot;)
 server.stop
</pre>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="#M000042">before_fork</a></li>
  <li><a href="#M000041">close_file_descriptors</a></li>
  <li><a href="#M000045">define_message_handler</a></li>
  <li><a href="#M000046">define_signal_handler</a></li>
  <li><a href="#M000044">finalize_server</a></li>
  <li><a href="#M000043">initialize_server</a></li>
  <li><a href="#M000037">new</a></li>
  <li><a href="#M000053">quit_main</a></li>
  <li><a href="#M000050">recv_from_client</a></li>
  <li><a href="#M000048">recv_from_server</a></li>
  <li><a href="#M000049">recv_io_from_server</a></li>
  <li><a href="#M000052">send_io_to_client</a></li>
  <li><a href="#M000051">send_to_client</a></li>
  <li><a href="#M000047">send_to_server</a></li>
  <li><a href="#M000038">start</a></li>
  <li><a href="#M000039">start_synchronously</a></li>
  <li><a href="#M000040">stop</a></li>
  </ul>

<div class="sectiontitle">Included Modules</div>
<ul>
  <li><a href="Utils.html">Utils</a></li>
</ul>


  <div class="sectiontitle">Classes and Modules</div>
  Class <a href="AbstractServer/ServerAlreadyStarted.html" class="link">ModRails::AbstractServer::ServerAlreadyStarted</a><br />
Class <a href="AbstractServer/ServerNotStarted.html" class="link">ModRails::AbstractServer::ServerNotStarted</a><br />
Class <a href="AbstractServer/UnknownMessage.html" class="link">ModRails::AbstractServer::UnknownMessage</a><br />


  <div class="sectiontitle">Constants</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class="attr-name">SERVER_TERMINATION_SIGNAL</td>
    <td>=</td>
    <td class="attr-value">&quot;SIGTERM&quot;</td>
  </tr>
  </table>

  <div class="sectiontitle">Attributes</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>file_descriptors_to_close</td>
    <td class='attr-desc'>
An array of integers, representing the file descriptors that should be
closed in the server&#8216;s child process. It can also be nil. This is
used internally by mod_rails and should not be used directly.

</td>
  </tr>
  </table>

<div class="sectiontitle">Public Class methods</div>
<div class="method">
  <div class="title">
    <a name="M000037"></a><b>new</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000037_source')" id="l_M000037_source">show source</a> ]</p>
  <div id="M000037_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 67</span>
67:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>
68:                 <span class="ruby-ivar">@done</span> = <span class="ruby-keyword kw">false</span>
69:                 <span class="ruby-ivar">@message_handlers</span> = {}
70:                 <span class="ruby-ivar">@signal_handlers</span> = {}
71:                 <span class="ruby-ivar">@orig_signal_handlers</span> = {}
72:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div class="method">
  <div class="title">
    <a name="M000038"></a><b>start</b>()
  </div>
  <div class="description">
  <p>
Start the server. This method does not block since the server runs
asynchronously from the current process.
</p>
<p>
You may only call this method if the server is not already started.
Otherwise, a <a
href="AbstractServer/ServerAlreadyStarted.html">ServerAlreadyStarted</a>
will be raised.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000038_source')" id="l_M000038_source">show source</a> ]</p>
  <div id="M000038_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 79</span>
 79:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start</span>
 80:                 <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@parent_channel</span>.<span class="ruby-identifier">nil?</span>
 81:                         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ServerAlreadyStarted</span>, <span class="ruby-value str">&quot;Server is already started&quot;</span>
 82:                 <span class="ruby-keyword kw">end</span>
 83:         
 84:                 <span class="ruby-ivar">@parent_socket</span>, <span class="ruby-ivar">@child_socket</span> = <span class="ruby-constant">UNIXSocket</span>.<span class="ruby-identifier">pair</span>
 85:                 <span class="ruby-identifier">before_fork</span>
 86:                 <span class="ruby-ivar">@pid</span> = <span class="ruby-identifier">fork</span> <span class="ruby-keyword kw">do</span>
 87:                         <span class="ruby-keyword kw">begin</span>
 88:                                 <span class="ruby-ivar">@parent_socket</span>.<span class="ruby-identifier">close</span>
 89:                                 <span class="ruby-identifier">start_synchronously</span>(<span class="ruby-ivar">@child_socket</span>)
 90:                         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Interrupt</span>
 91:                                 <span class="ruby-comment cmt"># Do nothing.</span>
 92:                         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">SignalException</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">signal</span>
 93:                                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">signal</span>.<span class="ruby-identifier">message</span> <span class="ruby-operator">==</span> <span class="ruby-constant">SERVER_TERMINATION_SIGNAL</span>
 94:                                         <span class="ruby-comment cmt"># Do nothing.</span>
 95:                                 <span class="ruby-keyword kw">else</span>
 96:                                         <span class="ruby-identifier">raise</span>
 97:                                 <span class="ruby-keyword kw">end</span>
 98:                         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
 99:                                 <span class="ruby-identifier">print_exception</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">e</span>)
100:                         <span class="ruby-keyword kw">ensure</span>
101:                                 <span class="ruby-identifier">exit!</span>
102:                         <span class="ruby-keyword kw">end</span>
103:                 <span class="ruby-keyword kw">end</span>
104:                 <span class="ruby-ivar">@child_socket</span>.<span class="ruby-identifier">close</span>
105:                 <span class="ruby-ivar">@parent_channel</span> = <span class="ruby-constant">MessageChannel</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@parent_socket</span>)
106:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000039"></a><b>start_synchronously</b>(socket)
  </div>
  <div class="description">
  <p>
Start the server, but in the current process instead of in a child process.
This method blocks until the server&#8216;s main loop has ended.
</p>
<p>
<em>socket</em> is the socket that the server should listen on. The server
main loop will end if the socket has been closed.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000039_source')" id="l_M000039_source">show source</a> ]</p>
  <div id="M000039_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 113</span>
113:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start_synchronously</span>(<span class="ruby-identifier">socket</span>)
114:                 <span class="ruby-ivar">@child_socket</span> = <span class="ruby-identifier">socket</span>
115:                 <span class="ruby-ivar">@child_channel</span> = <span class="ruby-constant">MessageChannel</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">socket</span>)
116:                 <span class="ruby-keyword kw">begin</span>
117:                         <span class="ruby-identifier">reset_signal_handlers</span>
118:                         <span class="ruby-identifier">close_file_descriptors</span>
119:                         <span class="ruby-identifier">initialize_server</span>
120:                         <span class="ruby-keyword kw">begin</span>
121:                                 <span class="ruby-identifier">main_loop</span>
122:                         <span class="ruby-keyword kw">ensure</span>
123:                                 <span class="ruby-identifier">finalize_server</span>
124:                         <span class="ruby-keyword kw">end</span>
125:                 <span class="ruby-keyword kw">ensure</span>
126:                         <span class="ruby-identifier">revert_signal_handlers</span>
127:                 <span class="ruby-keyword kw">end</span>
128:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000040"></a><b>stop</b>()
  </div>
  <div class="description">
  <p>
Stop the server. The server will quit as soon as possible. This method
waits until the server has been stopped.
</p>
<p>
When calling this method, the server must already be started. If not, a <a
href="AbstractServer/ServerNotStarted.html">ServerNotStarted</a> will be
raised.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000040_source')" id="l_M000040_source">show source</a> ]</p>
  <div id="M000040_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 135</span>
135:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stop</span>
136:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@parent_channel</span>.<span class="ruby-identifier">nil?</span>
137:                         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ServerNotStarted</span>, <span class="ruby-value str">&quot;Server is not started&quot;</span>
138:                 <span class="ruby-keyword kw">end</span>
139:                 
140:                 <span class="ruby-ivar">@parent_socket</span>.<span class="ruby-identifier">close</span>
141:                 <span class="ruby-ivar">@parent_channel</span> = <span class="ruby-keyword kw">nil</span>
142:                 <span class="ruby-constant">Process</span>.<span class="ruby-identifier">kill</span>(<span class="ruby-constant">SERVER_TERMINATION_SIGNAL</span>, <span class="ruby-ivar">@pid</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
143:                 <span class="ruby-constant">Process</span>.<span class="ruby-identifier">waitpid</span>(<span class="ruby-ivar">@pid</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
144:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Protected Instance methods</div>
<div class="method">
  <div class="title">
    <a name="M000042"></a><b>before_fork</b>()
  </div>
  <div class="description">
  <p>
A hook which is called when the server is being started, just before
forking a <a href="AbstractServer.html#M000037">new</a> process. The
default implementation does nothing, this method is supposed to be
overrided by child classes.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000042_source')" id="l_M000042_source">show source</a> ]</p>
  <div id="M000042_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 158</span>
158:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">before_fork</span>
159:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000041"></a><b>close_file_descriptors</b>()
  </div>
  <div class="description">
  <p>
Close the file descriptors, as specified by
<em>file_descriptors_to_close</em>.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000041_source')" id="l_M000041_source">show source</a> ]</p>
  <div id="M000041_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 148</span>
148:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close_file_descriptors</span>
149:                 <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">file_descriptors_to_close</span>.<span class="ruby-identifier">nil?</span>
150:                         <span class="ruby-identifier">file_descriptors_to_close</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fd</span><span class="ruby-operator">|</span>
151:                                 <span class="ruby-constant">IO</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">fd</span>).<span class="ruby-identifier">close</span>
152:                         <span class="ruby-keyword kw">end</span>
153:                 <span class="ruby-keyword kw">end</span>
154:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000045"></a><b>define_message_handler</b>(message_name, handler)
  </div>
  <div class="description">
  <p>
Define a handler for a message. <em>message_name</em> is the name of the
message to handle, and <em>handler</em> is the name of a method to be
called (this may either be a String or a Symbol).
</p>
<p>
A message is just a list of strings, and so <em>handler</em> will be called
with the message as its arguments, excluding the first element. See also
the example in the class description.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000045_source')" id="l_M000045_source">show source</a> ]</p>
  <div id="M000045_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 178</span>
178:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_message_handler</span>(<span class="ruby-identifier">message_name</span>, <span class="ruby-identifier">handler</span>)
179:                 <span class="ruby-ivar">@message_handlers</span>[<span class="ruby-identifier">message_name</span>.<span class="ruby-identifier">to_s</span>] = <span class="ruby-identifier">handler</span>
180:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000046"></a><b>define_signal_handler</b>(signal, handler)
  </div>
  <div class="description">
  <p>
Define a handler for a signal.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000046_source')" id="l_M000046_source">show source</a> ]</p>
  <div id="M000046_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 183</span>
183:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_signal_handler</span>(<span class="ruby-identifier">signal</span>, <span class="ruby-identifier">handler</span>)
184:                 <span class="ruby-ivar">@signal_handlers</span>[<span class="ruby-identifier">signal</span>.<span class="ruby-identifier">to_s</span>] = <span class="ruby-identifier">handler</span>
185:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000044"></a><b>finalize_server</b>()
  </div>
  <div class="description">
  <p>
A hook which is called when the server is being stopped. This is called in
the child process, after the main loop has been left. The default
implementation does nothing, this method is supposed to be overrided by
child classes.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000044_source')" id="l_M000044_source">show source</a> ]</p>
  <div id="M000044_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 170</span>
170:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">finalize_server</span>
171:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000043"></a><b>initialize_server</b>()
  </div>
  <div class="description">
  <p>
A hook which is called when the server is being started. This is called in
the child process, before the main loop is entered. The default
implementation does nothing, this method is supposed to be overrided by
child classes.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000043_source')" id="l_M000043_source">show source</a> ]</p>
  <div id="M000043_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 164</span>
164:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize_server</span>
165:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000053"></a><b>quit_main</b>()
  </div>
  <div class="description">
  <p>
Tell the main loop to <a href="AbstractServer.html#M000040">stop</a> as
soon as possible.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000053_source')" id="l_M000053_source">show source</a> ]</p>
  <div id="M000053_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 253</span>
253:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">quit_main</span>
254:                 <span class="ruby-ivar">@done</span> = <span class="ruby-keyword kw">true</span>
255:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000050"></a><b>recv_from_client</b>()
  </div>
  <div class="description">
  <p>
Receive a message from the client. Returns an array of strings, which
represents the message. Returns nil if the client has already closed the
connection. This method never throws any exceptions.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000050_source')" id="l_M000050_source">show source</a> ]</p>
  <div id="M000050_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 225</span>
225:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">recv_from_client</span>
226:                 <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@child_channel</span>.<span class="ruby-identifier">read</span>
227:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000048"></a><b>recv_from_server</b>()
  </div>
  <div class="description">
  <p>
Receive a message from the server. Returns an array of strings, which
represents the message. Returns nil if the server has already closed the
connection. This method never throws any exceptions.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000048_source')" id="l_M000048_source">show source</a> ]</p>
  <div id="M000048_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 208</span>
208:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">recv_from_server</span>
209:                 <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@parent_channel</span>.<span class="ruby-identifier">read</span>
210:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000049"></a><b>recv_io_from_server</b>()
  </div>
  <div class="description">
  <p>
Receive an IO object from the server. Please search Google on Unix sockets
file descriptors passing if you&#8216;re unfamiliar with this.
</p>
<p>
Raises SocketError if the next item in the server connection stream is not
a file descriptor, or if end-of-stream has been reached. Raises IOError if
the server connection stream is already closed on this side.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000049_source')" id="l_M000049_source">show source</a> ]</p>
  <div id="M000049_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 218</span>
218:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">recv_io_from_server</span>
219:                 <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@parent_channel</span>.<span class="ruby-identifier">recv_io</span>
220:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000052"></a><b>send_io_to_client</b>(io)
  </div>
  <div class="description">
  <p>
Send an IO object back to the client. Please search Google on Unix sockets
file descriptors passing if you&#8216;re unfamiliar with this.
</p>
<p>
Raises SocketError if the next item in the client connection stream is not
a file descriptor, or if end-of-stream has been reached. Raises IOError if
the client connection stream is already closed on this side.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000052_source')" id="l_M000052_source">show source</a> ]</p>
  <div id="M000052_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 248</span>
248:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_io_to_client</span>(<span class="ruby-identifier">io</span>)
249:                 <span class="ruby-ivar">@child_channel</span>.<span class="ruby-identifier">send_io</span>(<span class="ruby-identifier">io</span>)
250:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000051"></a><b>send_to_client</b>(name, *args)
  </div>
  <div class="description">
  <p>
Send a message back to the server. <em>name</em> is the name of the
message, and <em>args</em> are optional arguments for the message. Note
that all arguments will be turned into strings before they are sent to the
server, so you cannot specify complex objects as arguments. Furthermore,
all arguments, when stringified, may not contain the character as specified
by MessageChannel::DELIMITER.
</p>
<p>
Raises Errno::EPIPE if the server has already closed the connection. Raises
IOError if the client connection channel has already been closed on this
side (unlikely to happen; <a href="AbstractServer.html">AbstractServer</a>
never does this).
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000051_source')" id="l_M000051_source">show source</a> ]</p>
  <div id="M000051_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 238</span>
238:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_to_client</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
239:                 <span class="ruby-ivar">@child_channel</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
240:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000047"></a><b>send_to_server</b>(name, *args)
  </div>
  <div class="description">
  <p>
Send a message to the server. <em>name</em> is the name of the message, and
<em>args</em> are optional arguments for the message. Note that all
arguments will be turned into strings before they are sent to the server,
so you cannot specify complex objects as arguments. Furthermore, all
arguments, when stringified, may not contain the character as specified by
MessageChannel::DELIMITER.
</p>
<p>
The server must already be started. Otherwise, a <a
href="AbstractServer/ServerNotStarted.html">ServerNotStarted</a> will be
raised. Raises Errno::EPIPE if the server has already closed the
connection. Raises IOError if the server connection channel has already
been closed on this side (unlikely to happen; <a
href="AbstractServer.html">AbstractServer</a> never does this except when
<a href="AbstractServer.html#M000040">stop</a>() is called).
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000047_source')" id="l_M000047_source">show source</a> ]</p>
  <div id="M000047_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mod_rails/abstract_server.rb, line 198</span>
198:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_to_server</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
199:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@parent_channel</span>.<span class="ruby-identifier">nil?</span>
200:                         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ServerNotStarted</span>, <span class="ruby-value str">&quot;Server hasn't been started yet. Please call start() first.&quot;</span>
201:                 <span class="ruby-keyword kw">end</span>
202:                 <span class="ruby-ivar">@parent_channel</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
203:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>

    </body>
</html>